<%- include("../partials/user/header.ejs") %>

<div class="container my-4">
  <div class="row gx-4">
    <!-- LEFT: sidebar -->
    <div class="col-12 col-md-3">
      <%- include("../partials/user/userSidebar.ejs") %>
    </div>

    <!-- RIGHT: main content -->
    <div class="col-12 col-md-9">
      <div class="mb-4">
        <h2 class="fw-bold mb-1">My Address Book</h2>
        <p class="text-muted">Here you can manage your addresses</p>
      </div>

      <!-- Addresses list -->
      <div id="addresses-list">
        <% const addresses = (user && user.addresses) ? user.addresses : []; %>

        <% if (!addresses.length) { %>
          <div class="card p-4 mb-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <p class="mb-0">No addresses yet â€” <a href="/address/add">Add one</a></p>
              </div>
              <div>
                <a href="/address/add" class="btn btn-dark">Add New Address</a>
              </div>
            </div>
          </div>
        <% } else { %>

          <% addresses.forEach(function(addr) { %>
            <div class="address-card card mb-3 p-3">
              <div class="d-flex align-items-start">
                <div class="flex-grow-1 pe-3">
                  <div class="mb-1">
                    <strong class="d-block"><%= addr.name %></strong>
                    <small class="text-muted"><%= addr.label || 'Home' %></small>
                  </div>

                  <div class="address-lines text-muted">
                    <div><%= addr.line1 %></div>
                    <% if (addr.line2) { %><div><%= addr.line2 %></div><% } %>
                    <div><%= [addr.city, addr.state].filter(Boolean).join(', ') %></div>
                    <% if (addr.postalCode) { %><div><%= addr.postalCode %></div><% } %>
                    <% if (addr.phone) { %><div>Contact : <%= addr.phone %></div><% } %>
                  </div>
                </div>

                <div class="text-end ms-3" style="min-width:160px;">
                  <div class="mb-3">
                    <% if (addr.isPrimary) { %>
  <span class="badge rounded-pill bg-secondary">Primary</span>
<% } else { %>
  <form action="/address/setPrimary/<%= addr._id %>" method="POST" class="d-inline">
    <button class="badge rounded-pill bg-secondary border-0" type="submit">Set as Primary</button>
  </form>
<% } %>

                  </div>

                  <div class="d-flex justify-content-end gap-2">
                    <a href="/address/edit/<%= addr._id %>" class="btn btn-dark btn-sm">Edit</a>

                    <form action="/address/delete/<%= addr._id %>?_method=DELETE" method="POST" onsubmit="return confirm('Delete this address?');">
                      <button type="submit" class="btn btn-outline-secondary btn-sm">Delete</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>

          <!-- Add new address button aligned right -->
          <div class="d-flex justify-content-end mt-3">
            <a href="/address/add" class="btn btn-dark">Add New Address</a>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include("../partials/user/footer.ejs") %>


<style>
  
  .address-card {
    border-radius: 10px;
    border: 1px solid #e6e6e6;
    background: #fff;
  }

  .address-lines div {
    line-height: 1.45;
  }


  @media (max-width: 767.98px) {
    .user-avatar-wrap { margin: 0 auto 0.6rem auto; } 
    .user-name-pill { display:block; margin: 0 auto; }
  }

  
  .address-card .text-end { min-width: 150px; }
</style>
