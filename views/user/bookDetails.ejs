<%- include("../partials/user/header.ejs") %>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item"><a href="/shop">Books</a></li>
          <li class="breadcrumb-item active" aria-current="page">Book Details</li>
        </ol>
      </nav>

      <!-- Book Details Card -->
      <div class="card shadow-sm">
        <div class="row g-0">
          <!-- Book Images -->

          <div class="col-md-4 text-center p-3">
  <!-- Main Image -->
  <img id="mainImage" 
       src="<%= book.coverImg %>" 
       class="img-fluid rounded border mb-3" 
       alt="<%= book.title %>" 
       style="cursor: zoom-in;"
       data-bs-toggle="modal" data-bs-target="#imageModal">

  <!-- Thumbnails -->
  <div class="d-flex justify-content-center gap-2">
    <% book.thumbnails.forEach((img, index) => { %>
      <img src="<%= img %>" 
           class="img-thumbnail thumb-image <%= index === 0 ? 'border border-2 border-primary' : '' %>" 
           style="width:80px; height:auto; cursor:pointer;" 
           alt="Thumbnail">
    <% }) %>
  </div>
</div>




<!-- Image Preview Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-transparent border-0">
      <div class="modal-body p-0">
        <div id="imageCarousel" class="carousel slide" data-bs-ride="false">
          <div class="carousel-inner">
            <% [book.coverImg, ...book.thumbnails].forEach((img, index) => { %>
              <div class="carousel-item <%= index === 0 ? 'active' : '' %> text-center">
                <img src="<%= img %>" 
                     class="img-fluid w-100" 
                     style="max-height: 80vh; object-fit: contain;" 
                     alt="Preview">
              </div>
            <% }) %>
          </div>
          <!-- Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#imageCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon bg-dark rounded-circle p-3"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#imageCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon bg-dark rounded-circle p-3"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>




          <!-- Book Info -->
          <div class="col-md-8 p-3">
            <h4><%= book.title %></h4>
            <p class="text-muted mb-1">by <%= book.author %></p>
            <p>
              <strong><%= book.pages %></strong> pages | <%= book.language %><br>
              Published: <%= book.published %><br>
              ISBN: <%= book.isbn %>
            </p>

            <div class="mb-2">
              ⭐ <%= book.rating %> (<%= book.reviews %> Reviews)
              <% if (book.stock) { %>
                <span class="badge bg-success">In Stock</span>
              <% } else { %>
                <span class="badge bg-danger">Out of Stock</span>
              <% } %>
            </div>

            <h5 class="text-success">₹<%= book.price %> 
              <small class="text-muted text-decoration-line-through">₹<%= book.oldPrice %></small>
            </h5>

            <p class="mt-3"><%= book.description %></p>

              <!-- Action Buttons -->
<div class="d-flex align-items-center gap-2 mt-4">
  <!-- Quantity Selector -->
  <div class="input-group" style="width: 120px;">
    <button class="btn btn-outline-secondary" type="button">-</button>
    <input type="text" class="form-control text-center" value="1">
    <button class="btn btn-outline-secondary" type="button">+</button>
  </div>

  <!-- Add to Cart -->
  <button class="btn btn-dark">Add to Cart</button>

  <!-- Wishlist -->
  <button class="btn btn-outline-secondary">
    <i class="bi bi-heart"></i>
  </button>
</div>

<!-- Buy Now -->
<div class="mt-3">
  <button class="btn btn-dark w-100 py-2 fw-bold">Buy Now</button>
</div>


<!-- Delivery Info -->
<div class="mt-4 border rounded">
  <div class="p-3 border-bottom">
    <h6 class="mb-1 d-flex align-items-center text-dark">
      <i class="bi bi-truck me-2 fs-5"></i> Free Delivery
    </h6>
    <small class="text-dark">
      <a href="#" class="text-decoration-underline text-dark">Enter your postal code for Delivery Availability</a>
    </small>
  </div>
  <div class="p-3">
    <h6 class="mb-1 d-flex align-items-center text-dark">
      <i class="bi bi-arrow-repeat me-2 fs-5"></i> Return Delivery
    </h6>
    <small class="text-dark">
      Free 30 Days Delivery Returns. 
      <a href="#" class="text-decoration-underline text-dark">Details</a>
    </small>
  </div>
</div>




            <!-- <h6>Benefits</h6>
            <ul>
              <% book.benefits.forEach(benefit => { %>
                <li><%= benefit %></li>
              <% }) %>
            </ul> -->

            <!-- <div class="mt-3">
              <p><i class="bi bi-truck"></i> Free Delivery</p>
              <p><i class="bi bi-arrow-repeat"></i> Free 30 Days Delivery Returns</p>
            </div> -->
          </div>
        </div>
      </div><!-- /card -->
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const mainImage = document.getElementById("mainImage");
    const thumbs = document.querySelectorAll(".thumb-image");
    const carousel = document.getElementById("imageCarousel");
    const carouselInstance = new bootstrap.Carousel(carousel, { interval: false });

    // When main image clicked → open modal and sync carousel to current image
    mainImage.addEventListener("click", function() {
      const currentSrc = this.src;
      const items = carousel.querySelectorAll(".carousel-item");
      items.forEach((item, index) => {
        const img = item.querySelector("img");
        if (img.src.includes(currentSrc)) {
          carouselInstance.to(index);
        }
      });
    });

    // Thumbnails → update main image + highlight + sync carousel
    thumbs.forEach((thumb, index) => {
      thumb.addEventListener("click", function() {
        mainImage.src = this.src;

        // Highlight selected thumb
        thumbs.forEach(t => t.classList.remove("border", "border-2", "border-primary"));
        this.classList.add("border", "border-2", "border-primary");

        // Sync carousel to clicked thumb
        carouselInstance.to(index + 1); // +1 because coverImg is index 0
      });
    });
  });
</script>



 <%- include("../partials/user/footer.ejs") %>
