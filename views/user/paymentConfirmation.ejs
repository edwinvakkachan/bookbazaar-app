<%- include("../partials/user/header.ejs") %>



<style>
  .confirm-wrap{max-width:900px;margin:36px auto;padding:24px}
  .card{background:#fff;border:1px solid #e6e6e6;border-radius:8px;padding:22px}
  .check-circle{width:72px;height:72px;border-radius:50%;background:#2f6df6;color:#fff;display:inline-flex;align-items:center;justify-content:center;margin:0 auto 14px;box-shadow:0 0 0 8px rgba(47,109,246,0.08)}
  .small-muted{color:#6b6b6b;font-size:14px}
  .row-keys{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee;align-items:center}
  .items-table{width:100%;border-collapse:collapse;margin-top:10px}
  .items-table th,.items-table td{padding:10px;border-bottom:1px solid #f0f0f0;text-align:left}
  .totals{margin-top:12px}
  .actions{display:flex;gap:10px;justify-content:center;margin-top:18px}
  .btn{padding:10px 18px;border-radius:6px;text-decoration:none;display:inline-block}
  .btn-dark{background:#111;color:#fff}
  .btn-outline{background:#fff;border:1px solid #ccc;color:#333}
  .muted{color:#777;font-size:13px}
</style>

<div class="confirm-wrap">
  <div class="card text-center">
    <div class="check-circle" aria-hidden="true">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>

    <h2>Payment Successful</h2>
    <p class="muted">Thanks — your order has been placed.</p>

    <div style="max-width:720px;margin:18px auto 0;text-align:left">
      <div class="row-keys">
        <div class="small-muted">Order ID</div>
        <div><strong><%= order.orderId || String(order._id) %></strong></div>
      </div>

      <div class="row-keys">
        <div class="small-muted">Order Date</div>
        <div><strong><%= dateStr %> <span class="muted">at</span> <%= timeStr %></strong></div>
      </div>

      <div class="row-keys">
        <div class="small-muted">Payment Method</div>
        <div><strong><%= paymentMethod %></strong></div>
      </div>

      <div class="row-keys" style="border-bottom:2px solid #f5f5f5">
        <div class="small-muted">Estimated Delivery</div>
        <div><strong><%= estDeliveryStr %></strong></div>
      </div>

      <!-- Items list -->
      <h4 style="margin-top:18px">Order Summary</h4>
      <table class="items-table">
        <thead>
          <tr>
            <th style="width:60%">Product</th>
            <th style="width:10%">Qty</th>
            <th style="width:15%">Unit</th>
            <th style="width:15%">Total</th>
          </tr>
        </thead>
        <tbody>
          <% (order.items || []).forEach(function(it, i){ %>
            <tr>
              <td>
                <div style="display:flex;gap:10px;align-items:center">
                  <% if (it.image) { %>
                    <img src="<%= it.image %>" alt="" style="width:48px;height:48px;object-fit:cover;border-radius:6px" />
                  <% } %>
                  <div>
                    <div><strong><%= it.title %></strong></div>
                    <% if (it.sku) { %><div class="muted" style="font-size:12px">SKU: <%= it.sku %></div><% } %>
                  </div>
                </div>
              </td>
              <td><%= it.qty %></td>
              <td>₹ <%= (it.priceAtAdd || 0).toLocaleString() %></td>
              <td>₹ <%= ((it.priceAtAdd || 0) * (it.qty || 1)).toLocaleString() %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <!-- Totals -->
      <div class="totals" style="text-align:right">
        <div class="row-keys" style="border-bottom:none;padding:6px 0">
          <div class="small-muted">Subtotal</div>
          <div>₹ <%= (order.subtotal || 0).toLocaleString() %></div>
        </div>
        <div class="row-keys" style="border-bottom:none;padding:6px 0">
          <div class="small-muted">Shipping</div>
          <div>₹ <%= (order.shipping || 0).toLocaleString() %></div>
        </div>
        <% if (order.discounts) { %>
          <div class="row-keys" style="border-bottom:none;padding:6px 0">
            <div class="small-muted">Discounts</div>
            <div>- ₹ <%= (order.discounts || 0).toLocaleString() %></div>
          </div>
        <% } %>
        <div class="row-keys" style="border-bottom:2px solid #eee;padding:8px 0;margin-top:8px">
          <div><strong>Total</strong></div>
          <div><strong>₹ <%= (order.total || 0).toLocaleString() %></strong></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <a class="btn btn-outline" href="/orders/<%= order.orderId || order._id %>">View Order</a>
        <a class="btn btn-dark" href="/orders/<%= order.orderId %>/invoice">Download Invoice (PDF)</a>

        <!-- Cancel / Return buttons -->
        <% if (!order.isCancelled && order.status !== 'shipped' && order.status !== 'delivered') { %>
          <form action="/orders/<%= order.orderId %>/cancel" method="POST" style="display:inline;">
            <input type="hidden" name="reason" value="">
            <button class="btn btn-outline" type="submit">Cancel Order</button>
          </form>
        <% } %>

        <% if (order.status === 'delivered' && !order.isReturned) { %>
          <a class="btn btn-outline" href="/orders/<%= order.orderId %>/return">Request Return</a>
        <% } %>
      </div>

    </div>
  </div>
</div>



  <%- include("../partials/user/footer.ejs") %>
