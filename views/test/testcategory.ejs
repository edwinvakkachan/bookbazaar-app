<%- include('../partials/admin/header') %>

<h2 class="page-title mb-3">Categories</h2>

<!-- Search & Add -->
<form action="/admin/category" method="get" class="d-flex flex-wrap align-items-center gap-2 mb-3">
  <input type="text" class="form-control flex-grow-1" placeholder="Search categories..." name="search" value="<%= search || '' %>">
  <button class="btn btn-success" type="submit">Search</button>
  <a href="/admin/addCategory" class="btn btn-primary ms-auto">Add Category</a>
</form>

<!-- Categories Table -->
<div class="card table-responsive">
  <table class="table table-hover align-middle m-0">
    <thead class="table-light">
      <tr>
        <th>NAME</th>
        <th>DESCRIPTION</th>
        <th>STATUS</th>
        <th class="text-end">ACTION</th>
      </tr>
    </thead>
    <tbody>
      <% if (!category || category.length === 0) { %>
        <tr>
          <td colspan="4" class="text-center">No category found</td>
        </tr>
      <% } else { %>
        <% category.forEach(cat => { %>
          <tr>
            <td><%= cat.name %></td>
            <td class="text-muted"><%= cat.description || '-' %></td>
            <td>
              <% if (cat.isListed) { %>
                <span class="badge text-bg-danger">Blocked</span>
              <% } else { %>
                <span class="badge text-bg-success">Active</span>
              <% } %>
            </td>
            <td class="text-end">
              <a href="/admin/categories/<%= cat._id %>/edit" class="btn btn-sm btn-outline-primary">Edit</a>
              <% if (cat.isListed) { %>
                <form action="/admin/categories/<%= cat._id %>/unblock" method="POST" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-success">Unblock</button>
                </form>
              <% } else { %>
                <form action="/admin/categories/<%= cat._id %>/block" method="POST" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-danger">Block</button>
                </form>
              <% } %>
            </td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<nav class="mt-3">
  <ul class="pagination">
    <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
          <a class="page-link" href="?page=<%= i %><%= search ? `&search=${search}` : '' %>"><%= i %></a>
        </li>
      <% } %>
    <% } %>
  </ul>
</nav>

<%- include('../partials/admin/footer') %>
